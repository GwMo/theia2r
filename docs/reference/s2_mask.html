<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Apply cloud masks — s2_mask • An R toolbox to find, download an preprocess Sentinel-2 data</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Apply cloud masks — s2_mask" />

<meta property="og:description" content="s2_mask Applies a cloud mask to a Sentinel-2 product. Since
raster functions are used to perform computations, output files
are physical rasters (no output VRT is allowed).
s2_perc_masked computes the percentage of cloud-masked surface.
The function is similar to s2_mask, but it returns percentages instead
of masked rasters." />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-11080708-8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-11080708-8');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sen2r</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Function reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ranghetti/sen2r/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Apply cloud masks</h1>
    <small class="dont-index">Source: <a href='https://github.com/ranghetti/sen2r/blob/master/R/s2_mask.R'><code>R/s2_mask.R</code></a></small>
    <div class="hidden name"><code>s2_mask.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>s2_mask Applies a cloud mask to a Sentinel-2 product. Since
raster functions are used to perform computations, output files
are physical rasters (no output VRT is allowed).</p>
<p>s2_perc_masked computes the percentage of cloud-masked surface.
The function is similar to s2_mask, but it returns percentages instead
of masked rasters.</p>
    
    </div>

    <pre class="usage"><span class='fu'>s2_mask</span>(<span class='no'>infiles</span>, <span class='no'>maskfiles</span>, <span class='kw'>mask_type</span> <span class='kw'>=</span> <span class='st'>"cloud_medium_proba"</span>, <span class='kw'>smooth</span> <span class='kw'>=</span> <span class='fl'>20</span>,
  <span class='kw'>buffer</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>max_mask</span> <span class='kw'>=</span> <span class='fl'>80</span>, <span class='kw'>outdir</span> <span class='kw'>=</span> <span class='st'>"./masked"</span>, <span class='kw'>tmpdir</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
  <span class='kw'>rmtmp</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>save_binary_mask</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>format</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>subdirs</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
  <span class='kw'>compress</span> <span class='kw'>=</span> <span class='st'>"DEFLATE"</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>overwrite</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>.log_message</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>.log_output</span> <span class='kw'>=</span> <span class='fl'>NA</span>)

<span class='fu'>s2_perc_masked</span>(<span class='no'>infiles</span>, <span class='no'>maskfiles</span>, <span class='kw'>mask_type</span> <span class='kw'>=</span> <span class='st'>"cloud_medium_proba"</span>,
  <span class='kw'>tmpdir</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>rmtmp</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>infiles</th>
      <td><p>A vector of input filenames. Input files are paths
of products already converted from SAFE format to a
format managed by GDAL (use <a href='s2_translate.html'>s2_translate</a> to do it);
their names must be in the sen2r naming convention
(<a href='safe_shortname.html'>safe_shortname</a>).</p></td>
    </tr>
    <tr>
      <th>maskfiles</th>
      <td><p>A vector of filenames from which to take the
information about cloud coverage (for now, only SCL products
have been implemented). It is not necessary that <code>maskfiles</code>
elements strictly match <code>infiles</code> ones. Input files are paths
of products already converted from SAFE format to a
format managed by GDAL (use <a href='s2_translate.html'>s2_translate</a> to do it);
their names must be in the sen2r naming convention
(<a href='safe_shortname.html'>safe_shortname</a>).</p></td>
    </tr>
    <tr>
      <th>mask_type</th>
      <td><p>(optional) Character vector which determines the type of
mask to be applied. Accepted values are:</p><ul>
<li><p>"nomask": do not mask any pixel;</p></li>
<li><p>"nodata": mask pixels checked as "No data" or "Saturated or defective"
in the SCL product (all pixels with values are maintained);</p></li>
<li><p>"cloud_high_proba": mask pixels checked as "No data", "Saturated or
defective" or "Cloud (high probability)" in the SCL product;</p></li>
<li><p>"cloud_medium_proba": mask pixels checked as "No data", "Saturated or
defective" or "Cloud (high or medium probability)" in the SCL product;</p></li>
<li><p>"cloud_low_proba": mask pixels checked as "No data", "Saturated or
defective" or "Cloud (any probability)" in the SCL product;</p></li>
<li><p>"cloud_and_shadow": mask pixels checked as "No data", "Saturated or
defective", "Cloud (any probability)", "Cloud shadow" or "Dark area"
in the SCL product;</p></li>
<li><p>"clear_sky": mask pixels checked as "No data", "Saturated or
defective", "Cloud (any probability)", "Cloud shadow", "Dark area"
or "Thin cirrus" in the SCL product
(only pixels classified as clear-sky surface - so "Vegetation",
"Bare soil", "Water" or "Snow" - are maintained);</p></li>
<li><p>"land": mask pixels checked as "No data", "Saturated or
defective", "Cloud (any probability)", "Cloud shadow", "Dark area",
"Thin cirrus", "Water" or "Snow" in the SCL product
(only pixels classified as land surface - so "Vegetation" or
"Bare soil" - are maintained);</p></li>
<li><p>a string in the following form: "scl_n_m_n", where n, m and n are one or
more SCL class numbers (e.g. "scl_0_8_9_11"): mask pixels corresponding
to the classes specified in the string. E.g. string "scl_0_8_9_11" can
be used to mask classes 0 ("No data"), 8-9 ("Cloud (high or medium
probability)") and 11 ("Snow");</p></li>
<li><p>"opaque_clouds" (still to be implemented).</p></li>
</ul></td>
    </tr>
    <tr>
      <th>smooth</th>
      <td><p>(optional) Numerical (positive): should the mask be smoothed=the size (in the unit of
<code>inmask</code>, typically metres) to be used as radius for the smoothing
(the higher it is, the more smooth the output mask will result).
Defaul is 20.</p></td>
    </tr>
    <tr>
      <th>buffer</th>
      <td><p>(optional) Numerical (positive or negative): the size of the
buffer (in the unit of <code>inmask</code>, typically metres) to be applied to the
masked area after smoothing it (positive to enlarge, negative to reduce).
Defaul is 10.</p></td>
    </tr>
    <tr>
      <th>max_mask</th>
      <td><p>(optional) Numeric value (range 0 to 100), which represents
the maximum percentage of allowed masked surface (by clouds or any other
type of mask chosen with argument <code>mask_type</code>) for producing outputs.
Images with a percentage of masked surface greater than <code>max_mask</code><!-- % -->
are not processed (the list of expected output files which have not been
generated is returned as an attribute, named "skipped").
Default value is 80.
Notice that the percentage is computed on non-NA values (if input images
had previously been clipped and masked using a polygon, the percentage is
computed on the surface included in the masking polygons).</p></td>
    </tr>
    <tr>
      <th>outdir</th>
      <td><p>(optional) Full name of the output directory where
the files should be created (default: "current directory"masked"
subdir of current directory).
<code>outdir</code> can bot be an existing or non-existing directory (in the
second case, its parent directory must exists).
If it is a relative path, it is expanded from the common parent
directory of <code>infiles</code>.</p></td>
    </tr>
    <tr>
      <th>tmpdir</th>
      <td><p>(optional) Path where intermediate files (VRT) will be created.
Default is a temporary directory.</p></td>
    </tr>
    <tr>
      <th>rmtmp</th>
      <td><p>(optional) Logical: should temporary files be removed?
(Default: TRUE).
This parameter takes effect only if the output files are not VRT
(in this case temporary files cannot be deleted, because rasters of source
bands are included within them).</p></td>
    </tr>
    <tr>
      <th>save_binary_mask</th>
      <td><p>(optional) Logical: should binary masks be exported?
Binary mask are intermediate rasters used to apply the cloud mask:
pixel values can be 1 (no cloud mask), 0 (cloud mask) or NA (original NA
value, i.e. because input rasters had been clipped on the extent polygons).
If FALSE (default) they are not exported; if TRUE, they are exported
as MSK prod type (so saved within <code>outdir</code>, in a subdirectory called "MSK"
if <code>subdirs = TRUE</code>).
Notice that the presence of "MSK" products is not checked before running
<code><a href='sen2r.html'>sen2r()</a></code>, as done for the other products; this means that missing products
which are not required to apply cloud masks will not be produced.</p></td>
    </tr>
    <tr>
      <th>format</th>
      <td><p>(optional) Format of the output file (in a
format recognised by GDAL). Default is the same format of input images
(or "GTiff" in case of VRT input images).</p></td>
    </tr>
    <tr>
      <th>subdirs</th>
      <td><p>(optional) Logical: if TRUE, different indices are
placed in separated <code>outfile</code> subdirectories; if FALSE, they are placed in
<code>outfile</code> directory; if NA (default), subdirectories are created only if
more than a single spectral index is required.</p></td>
    </tr>
    <tr>
      <th>compress</th>
      <td><p>(optional) In the case a GTiff format is
present, the compression indicated with this parameter is used.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>(optional) Logical: if TRUE, masking is conducted using parallel
processing, to speed-up the computation for large rasters.
The number of cores is automatically determined; specifying it is also
possible (e.g. <code>parallel = 4</code>).
If FALSE (default), single core processing is used.
Multiprocess masking computation is always performed in singlecore mode
if <code>format != "VRT"</code> (because in this case there is no gain in using
multicore processing).</p></td>
    </tr>
    <tr>
      <th>overwrite</th>
      <td><p>(optional) Logical value: should existing output files be
overwritten? (default: FALSE)</p></td>
    </tr>
    <tr>
      <th>.log_message</th>
      <td><p>(optional) Internal parameter
(it is used when the function is called by <code><a href='sen2r.html'>sen2r()</a></code>).</p></td>
    </tr>
    <tr>
      <th>.log_output</th>
      <td><p>(optional) Internal parameter
(it is used when the function is called by <code><a href='sen2r.html'>sen2r()</a></code>).</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>s2_mask returns a vector with the names of the created products.
An attribute "toomasked" contains the paths of the outputs which were not
created cause to the high percentage of cloud coverage.</p>
<p>s2_perc_masked returns a names vector with the percentages
of masked surtfaces.</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>License: GPL 3.0</p>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#note">Note</a></li>
          </ul>

    <h2>Author</h2>
    
Luigi Ranghetti, phD (2017) <a href='mailto:ranghetti.l@irea.cnr.it'>ranghetti.l@irea.cnr.it</a>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Luigi Ranghetti, Lorenzo Busetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

